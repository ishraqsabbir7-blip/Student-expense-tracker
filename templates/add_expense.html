{% extends "base.html" %}
{% block content %}
<!-- Include Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Body and card theme */
body {
    background: linear-gradient(to bottom, #cceeff, #99ddff); /* light sky blue gradient */
    color: #003366;
    font-style: italic;
    font-family: 'Georgia', serif;
}

.card {
    background-color: rgba(255, 255, 255, 0.9);
    border: 2px solid #66b3ff;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

.card-header {
    background-color: #66b3ff;
    color: white;
    font-style: italic;
    text-align: center;
}

.form-label {
    font-style: italic;
    color: #003366;
}

.form-control {
    background-color: rgba(255,255,255,0.8);
    border: 1px solid #66b3ff;
    color: #003366;
    font-style: italic;
    padding-left: 35px; /* leave space for emoji */
    border-radius: 10px;
}

.form-control:focus {
    background-color: rgba(255,255,255,1);
    border-color: #3399ff;
    color: #003366;
}

.input-icon {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2rem;
}

.form-group {
    position: relative;
    margin-bottom: 1.5rem;
}

.btn-primary {
    background-color: #3399ff;
    border-color: #66b3ff;
    font-style: italic;
}

.btn-primary:hover {
    background-color: #007acc;
}

/* Graph container */
.graph-container {
    margin-top: 30px;
    background-color: rgba(255, 255, 255, 0.7);
    padding: 15px;
    border-radius: 10px;
}
</style>

<div class="card mx-auto my-5" style="max-width: 500px;">
    <div class="card-header">
        <h4 class="mb-0">Add Daily Expense</h4>
    </div>
    <div class="card-body">
        <form method="POST" action="/add_expense">
            <div class="form-group">
                <span class="input-icon">üí∞</span>
                <input type="number" step="0.01" class="form-control" id="amount" name="amount" placeholder="Amount" required>
            </div>
            <div class="form-group">
                <span class="input-icon">üè∑Ô∏è</span>
                <input type="text" class="form-control" id="category" name="category" placeholder="Category">
            </div>
            <div class="form-group">
                <span class="input-icon">üìÖ</span>
                <input type="date" class="form-control" id="date" name="date" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Add Expense</button>
        </form>

        <!-- Graph Section -->
        <div class="graph-container">
            <canvas id="expenseChart"></canvas>
        </div>
    </div>
</div>

<script>
    const expensesData = {{ expenses_by_month|tojson }};
    const sortedLabels = Object.keys(expensesData).sort((a,b) => new Date(a + "-01") - new Date(b + "-01"));
    const sortedData = sortedLabels.map(month => expensesData[month]);

    const ctx = document.getElementById('expenseChart').getContext('2d');
    const expenseChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: sortedLabels,
            datasets: [{
                label: 'Monthly Expenses',
                data: sortedData,
                backgroundColor: '#3399ff',
                borderColor: '#66b3ff',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: {
                        color: '#003366',
                        font: { style: 'italic' }
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#003366', font: { style: 'italic' } },
                    grid: { color: 'rgba(0,0,0,0.05)' }
                },
                y: {
                    ticks: { color: '#003366', font: { style: 'italic' } },
                    grid: { color: 'rgba(0,0,0,0.05)' },
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
